Алгоритм решения задачи по анализу звонков из UIS телефонии

Техническое задание:
- Получение записей звонков через API UIS телефонии
- Транскрибация аудио через Whisper (OpenAI)
- Анализ транскрипций по заданным критериям через промпт
- Загрузка результатов анализа в Google таблицу

Алгоритм решения:

ЭТАП 1: Настройка интеграции с UIS телефонией
1.1. Изучение документации API UIS телефонии
1.2. Получение credentials (API ключ, токен доступа)
1.3. Настройка авторизации и тестирование подключения
1.4. Разработка функции для получения списка записей звонков с фильтрацией по датам/периодам
1.5. Настройка загрузки аудиофайлов звонков

Технологии: Python, библиотеки requests/httpx для работы с API, JSON для обработки ответов

ЭТАП 2: Транскрибация аудио через Whisper
2.1. Настройка подключения к OpenAI API (API ключ)
2.2. Разработка функции транскрибации аудиофайлов через Whisper API
2.3. Обработка различных форматов аудио (конвертация при необходимости)
2.4. Обработка ошибок и retry-логика для надежности
2.5. Сохранение транскрипций во временное хранилище или память

Технологии: Python, OpenAI API (Whisper), библиотеки для работы с аудио (pydub, ffmpeg при необходимости)

ЭТАП 3: Анализ транскрипций по критериям
3.1. Получение от заказчика промпта с критериями анализа
3.2. Разработка функции анализа транскрипций с использованием LLM
3.3. Структурирование промпта для получения данных в формате, удобном для загрузки в таблицу
3.4. Обработка ответа LLM и парсинг результатов анализа
3.5. Валидация данных перед загрузкой

Технологии: Python, OpenAI API (GPT-4/GPT-3.5 для анализа), библиотека для работы с JSON/структурированными данными

ЭТАП 4: Загрузка результатов в Google таблицу
4.1. Настройка доступа к Google Sheets API (OAuth 2.0 или Service Account)
4.2. Создание/выбор целевой таблицы и определение структуры колонок
4.3. Разработка функции записи данных в Google таблицу
4.4. Форматирование данных: метаданные звонка, транскрипция, результаты анализа по критериям
4.5. Обработка ошибок и логирование операций

Технологии: Python, Google Sheets API, библиотека gspread или google-api-python-client

ЭТАП 5: Автоматизация процесса
5.1. Объединение всех этапов в единый пайплайн
5.2. Настройка обработки очереди звонков (batch processing)
5.3. Добавление логирования и мониторинга процесса
5.4. Настройка периодического запуска (cron, планировщик задач или веб-интерфейс)
5.5. Обработка edge cases: пропущенные звонки, ошибки API, пустые транскрипции

Технологии: Python, скрипт с функциями или FastAPI для веб-интерфейса, библиотека для планирования задач (schedule, APScheduler)

ОПЦИОНАЛЬНО: Дополнительные улучшения
- Настройка веб-интерфейса для мониторинга процесса (FastAPI + Streamlit)
- Добавление дашборда с метриками аналитики звонков
- Настройка уведомлений об ошибках (Telegram бот, email)
- Кэширование транскрипций для избежания повторных запросов
- Добавление базы данных для хранения истории обработки (PostgreSQL, MongoDB)

Используемые технологии и библиотеки:

Основной стек:
- Python 3.9+ (основной язык разработки)
- OpenAI API (Whisper для транскрибации, GPT для анализа)
- Google Sheets API (загрузка данных)
- requests/httpx (работа с UIS API)
- gspread или google-api-python-client (работа с Google таблицами)

Дополнительные библиотеки:
- json (обработка данных)
- pydub, ffmpeg-python (работа с аудио при необходимости)
- python-dotenv (хранение credentials)
- logging (логирование процесса)
- schedule/APScheduler (автоматизация запуска)

Опционально:
- FastAPI (веб-интерфейс, если нужен)
- Streamlit (дашборд, если нужен)
- PostgreSQL/MongoDB (база данных, если нужна)
- Docker (контейнеризация, если нужна)

Структура данных для Google таблицы:

Колонки таблицы:
1. Дата и время звонка
2. Номер звонящего
3. Номер принимающего
4. Длительность звонка
5. Ссылка на запись (если доступна)
6. Транскрипция разговора
7. [Критерии анализа - будут определены заказчиком в промпте]
   - Например: эмоциональный тон, наличие возражений, темы разговора, выявленные потребности и т.д.
8. Статус обработки
9. Дата обработки

Возможные критерии анализа (примеры для уточнения с заказчиком):
- Эмоциональный тон разговора (позитивный/нейтральный/негативный)
- Выявление возражений клиента
- Определение этапа продажи
- Выявление ключевых тем разговора
- Оценка качества обслуживания
- Выявление запросов клиента
- Определение необходимости обратного звонка

